æ¨¡å‹rknn int8ç®—åŠ› 9å¸§/6topsï¼Œ æ­£å¸¸èƒ½åœ¨16topsä¸‹è¾¾åˆ°24å¸§å·¦å³ã€‚ ä¹‹å‰ç®€å•çœ‹äº†ä¸‹æ¨¡å‹æ­¥éª¤ï¼Œå¤§æ¦‚åœ¨550å±‚ï¼Œåœ¨mgzå¹³å°åœ¨780
è¿æ‰³æ¨ç†ç±»ä¼¼ä»£ç ï¼ˆå¦‚ä¸æ”¯æŒéœ€è¦åˆ†æ­¥éª¤äººå·¥å®ç°ï¼‰
éªŒè¯é‡åŒ–ç«¯compareç²¾åº¦è¡¨æ˜¯å¦ä¸€è‡´ï¼Œæˆ–ç›´æ¥ä½¿ç”¨tensor_diffä¾æ®çš„ä½™å¼¦ç›¸ä¼¼åº¦



0.çœ‹ä¸‹ä¸Šé™è¯„æµ‹ï¼ˆå¦‚é‡‡ç”¨ int16åšä¸€æ¬¡ç²¾åº¦è¯„æµ‹ï¼‰
1.ç°æœ‰int8éå¯¹ç§°é‡åŒ–åšä¸€æ¬¡è¯„æµ‹  ï¼ˆä½ç²¾åº¦ + ä½è€—æ—¶ï¼‰
2.é‡‡ç”¨ä¸åŒé‡åŒ–ç®—æ³• + éå¯¹ç§°é‡åŒ–åšä¸€æ¬¡è¯„æµ‹




1.ç²¾åº¦ä¼˜åŒ–ï¼š
1ï¼‰é‡åŒ–ç®—æ³•  KL-D
2ï¼‰éå¯¹ç§°é‡åŒ–
3ï¼‰æ··åˆé‡åŒ–



2.é€Ÿåº¦ä¼˜åŒ–
1ï¼‰ONNXæ¨¡å‹å›¾åˆå¹¶
2ï¼‰ç¼–è¯‘å±‚ä¼˜åŒ–æ¨¡å‹ï¼ˆrknnç¼–è¯‘å™¨æä¾›äº†ä¼˜åŒ–ï¼‰
3ï¼‰å°½é‡ç²¾åº¦å±‚é¢ç”±ä½åˆ°é«˜ä¾æ¬¡ä¼˜åŒ–


3.è¯„æµ‹
1ï¼‰æŒ‡æ ‡ä¸»è¦æ˜¯æ¯ä¸ªç‚¹çš„åƒç´ å€¼æ¬§æ°è·ç¦»è¯¯å·®ï¼ˆåˆ—å‡ºè¯¯å·®æœ€å¤§å‰10ï¼Œä¸è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼‰ä»¥åŠå¹³å‡è¯¯å·®ï¼ˆä¸è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼‰
2ï¼‰ä½™å¼¦ç›¸ä¼¼åº¦


4.å®é™…æ“ä½œ
è¯„æµ‹æ•°æ®æ¥è‡ªåŒä¸€ä¸ªç›®å½•ä¸‹çš„å·¦å³å›¾ï¼š /home/lc/share/datas/left.png /home/lc/share/datas/right.png
é‡åŒ–int8  å’Œ onnx float32 ç”Ÿæˆæ•°æ®å¯¹æ¯”

1ï¼‰ sh export.sh ç”Ÿæˆonnxä¸‹çš„æ¨ç†npyè¾“å‡ºï¼š ./output/export_disparity.npy   ï¼ˆåªéœ€è¦æ“ä½œä¸€æ¬¡ï¼‰
2ï¼‰ python quant/tensor_show.py xxx/disp_pred_cast_output_0_1_1_256_512.tensor
ä¸­é—´ä¼šäº§ç”Ÿæ¿å­æ¨ç†çš„npyæ–‡ä»¶ï¼š./output/quant/disparity.npy   ï¼ˆæ¯æ¬¡æ“ä½œéœ€è¦ä½¿ç”¨æ–°äº§ç”Ÿçš„tensoræ–‡ä»¶ï¼‰
3ï¼‰ python quant/disparity_diff.py --board ./output/quant/disparity.npy --onnx ./output/export_disparity.npy


ä»£ç æ‰§è¡Œï¼š
python quant/disparity_diff.py --board ./output/quant/disparity.npy --onnx ./output/export_disparity.npy

è¾“å‡ºï¼š
âœ… å·²åŠ è½½æ–‡ä»¶:
  Board: ./output/quant/disparity.npy  shape=(256, 512)
  ONNX : ./output/export_disparity.npy  shape=(256, 512)

ğŸ“Š å¯¹æ¯”ç»“æœï¼š
ä½™å¼¦ç›¸ä¼¼åº¦: 0.993451
æ¬§å¼è·ç¦»: 878.008667
æœ€å¤§ç»å¯¹è¯¯å·®: 1.509447e+01
å¹³å‡ç»å¯¹è¯¯å·®: 1.770710e+00
å·®å¼‚è¶…è¿‡é˜ˆå€¼(1e-03)çš„æ¯”ä¾‹: 99.95%



å…¶ä»–å‚è€ƒæ•°æ®å¯¹æ¯”ï¼š

1ï¼‰é‡åŒ–fp16  å’Œ onnxç”Ÿæˆæ•°æ®å¯¹æ¯”
python quant/disparity_diff.py --board /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_ori.npy --onnx ./output/export_disparity.npy

âœ… å·²åŠ è½½æ–‡ä»¶:
  Board: /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_ori.npy  shape=(1, 1, 256, 512)
  ONNX : ./output/export_disparity.npy  shape=(256, 512)

ğŸ“Š å¯¹æ¯”ç»“æœï¼š
ä½™å¼¦ç›¸ä¼¼åº¦: 1.000000
æ¬§å¼è·ç¦»: 0.003870
æœ€å¤§ç»å¯¹è¯¯å·®: 7.057190e-05
å¹³å‡ç»å¯¹è¯¯å·®: 8.040486e-06
å·®å¼‚è¶…è¿‡é˜ˆå€¼(1e-03)çš„æ¯”ä¾‹: 0.00%

2ï¼‰é‡åŒ–fp16  å’Œ é‡åŒ–int8å¯¹æ¯”
python quant/disparity_diff.py --board /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_ori.npy --onnx /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_quanted.npy 

âœ… å·²åŠ è½½æ–‡ä»¶:
  Board: /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_ori.npy  shape=(1, 1, 256, 512)
  ONNX : /home/lc/share/gaoshantest/compare_light_out/layerdump/disp_pred_quanted.npy  shape=(1, 1, 256, 512)

ğŸ“Š å¯¹æ¯”ç»“æœï¼š
ä½™å¼¦ç›¸ä¼¼åº¦: 0.997416
æ¬§å¼è·ç¦»: 582.384216
æœ€å¤§ç»å¯¹è¯¯å·®: 8.032778e+00
å¹³å‡ç»å¯¹è¯¯å·®: 1.289533e+00
å·®å¼‚è¶…è¿‡é˜ˆå€¼(1e-03)çš„æ¯”ä¾‹: 99.95%

